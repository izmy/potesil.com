---
import ScrollArrow from "../icons/ScrollArrow.astro";
---

<section id="blog">
  <div class="content">
    <div class="text">
      <h1>Poděs píše</h1>

      <div class="latest-posts">
        <p>Načítám články...</p>
      </div>

      <div class="footer">
        <ScrollArrow href="#contact" variant="black" />
        <a class="link" href="https://podes.cz/" target="_blank"
          >Přejít na blog</a
        >
      </div>
    </div>
  </div>
</section>

<style lang="scss">
  section {
    display: flex;
    height: 100vh;
  }

  .content {
    display: flex;
    flex-direction: column;
    justify-content: center;

    height: 100vh;
    margin: auto;
    position: relative;
  }

  h1 {
    font-family: Inter;
    font-weight: 900;
    font-size: 3rem;
  }

  .latest-posts {
    display: flex;
    gap: 2rem;
  }

  .footer {
    display: flex;
    justify-content: space-between;
    margin-top: 2rem;
  }

  .link {
    background: #f8ff39;
    padding: 20px 100px;
    font-size: 1.25rem;
    color: black;

    &:hover {
      text-decoration: none;
    }
  }
</style>

<style lang="scss" is:global>
  article {
    width: 320px;

    .image {
      height: 200px;
      overflow: hidden;

      img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        display: block;
      }
    }

    h2 {
      background: #81eb78;
    }

    a {
      color: black;
    }
  }
</style>

<script is:inline>
  const NUM_OF_POSTS = 3;
  const ENDPOINT = `https://podes.cz/wp-json/wp/v2/posts?per_page=${NUM_OF_POSTS}&_embed`;

  async function loadPosts() {
    const container = document.getElementsByClassName("latest-posts")[0];
    container.innerHTML = "<p>Načítám...</p>";

    try {
      const res = await fetch(ENDPOINT);
      const posts = await res.json();

      console.log(posts);

      container.innerHTML = posts
        .map(
          (post) => `
        <article>
          <div class="image">
          ${
            post._embedded?.["wp:featuredmedia"]?.[0]?.source_url
              ? `<img src="${post._embedded["wp:featuredmedia"][0].source_url}" alt="${post.title.rendered}" />`
              : ""
          }
          </div>
          <h2><a href="${post.link}" target="_blank">${post.title.rendered}</a></h2>
          <p>${post.excerpt.rendered}</p>
        </article>
      `
        )
        .join("");
    } catch (err) {
      container.innerHTML = "<p>Chyba při načítání článků.</p>";
      console.error(err);
    }
  }

  document.addEventListener("DOMContentLoaded", loadPosts);
</script>

<style>
  #latest-posts {
    display: grid;
    gap: 2rem;
    max-width: 800px;
    margin: auto;
  }
  .post img {
    max-width: 100%;
    height: auto;
    border-radius: 8px;
  }
</style>
